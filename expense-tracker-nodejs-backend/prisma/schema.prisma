generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id           Int           @id @default(autoincrement())
  name         String        @db.VarChar(100)
  email        String        @unique @db.VarChar(100)
  password     String
  createdAt    DateTime      @default(now()) @map("created_at")
  wallets      Wallet[]
  categories   Category[]
  transactions Transaction[]
  budgets      Budget[]

  @@map("users")
}

model Wallet {
  id           Int           @id @default(autoincrement())
  userId       Int           @map("user_id")
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  name         String        @db.VarChar(50)
  type         String        @db.VarChar(20) // Bank Account, Cash, UPI, Credit Card
  balance      Decimal       @default(0) @db.Decimal(15, 2)
  createdAt    DateTime      @default(now()) @map("created_at")
  transactions Transaction[]

  @@map("wallets")
}

enum TransactionType {
  INCOME
  EXPENSE
}

model Category {
  id           Int             @id @default(autoincrement())
  name         String          @db.VarChar(50)
  type         TransactionType
  isDefault    Boolean         @default(false) @map("is_default")
  userId       Int?            @map("user_id")
  user         User?           @relation(fields: [userId], references: [id], onDelete: SetNull)
  transactions Transaction[]
  budgets      Budget[]

  @@map("categories")
}

model Transaction {
  id              Int             @id @default(autoincrement())
  userId          Int             @map("user_id")
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  walletId        Int             @map("wallet_id")
  wallet          Wallet          @relation(fields: [walletId], references: [id], onDelete: Cascade)
  categoryId      Int             @map("category_id")
  category        Category        @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  type            TransactionType
  amount          Decimal         @db.Decimal(15, 2)
  description     String?         @db.VarChar(255)
  transactionDate DateTime        @map("transaction_date") @db.Date
  billImageUrl    String?         @map("bill_image_url") @db.VarChar(500)
  createdAt       DateTime        @default(now()) @map("created_at")

  @@map("transactions")
}

model Budget {
  id         Int      @id @default(autoincrement())
  userId     Int      @map("user_id")
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  categoryId Int      @map("category_id")
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  amount     Float
  period     String   @default("MONTHLY") @db.VarChar(20)
  startDate  DateTime @map("startDate") @db.Date
  endDate    DateTime @map("endDate") @db.Date

  @@map("budgets")
}
